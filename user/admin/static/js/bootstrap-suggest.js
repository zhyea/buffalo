(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{if(typeof exports==="object"&&typeof module==="object"){factory(require("jquery"))}else{if(window.jQuery){factory(window.jQuery)}else{throw new Error("Not found jQuery.")}}}})(function($){var VERSION="VERSION_PLACEHOLDER";var $window=$(window);var isIe="ActiveXObject" in window;var inputLock;var chromeVer=navigator.userAgent.match(/Chrome\/(\d+)/);if(chromeVer){chromeVer=+chromeVer[1]}var notNeedCalcPadding=isIe||chromeVer>51;var BSSUGGEST="bsSuggest";var onDataRequestSuccess="onDataRequestSuccess";var DISABLED="disabled";var TRUE=true;var FALSE=false;function isUndefined(val){return val===void (0)}function handleError(e1,e2){if(!window.console||!window.console.trace){return}console.trace(e1);if(e2){console.trace(e2)}}function getPointKeyword($list){return $list.data()}function setOrGetAlt($input,val){return isUndefined(val)?$input.attr("alt"):$input.attr("alt",val)}function setOrGetDataId($input,val){return val!==(void 0)?$input.attr("data-id",val):$input.attr("data-id")}function setValue($input,keywords,options){if(!keywords||!keywords.key){return}var separator=options.separator||",",inputValList,inputIdList,dataId=setOrGetDataId($input);if(options&&options.multiWord){inputValList=$input.val().split(separator);inputValList[inputValList.length-1]=keywords.key;if(!dataId){inputIdList=[keywords.id]}else{inputIdList=dataId.split(separator);inputIdList.push(keywords.id)}setOrGetDataId($input,inputIdList.join(separator)).val(inputValList.join(separator)).focus()}else{setOrGetDataId($input,keywords.id||"").val(keywords.key).focus()}$input.data("pre-val",$input.val()).trigger("onSetSelectValue",[keywords,(options.data.value||options._lastData.value)[keywords.index]])}function adjustDropMenuPos($input,$dropdownMenu,options){if(!$dropdownMenu.is(":visible")){return}var $parent=$input.parent();var parentHeight=$parent.height();var parentWidth=$parent.width();if(options.autoDropup){setTimeout(function(){var offsetTop=$input.offset().top;var winScrollTop=$window.scrollTop();var menuHeight=$dropdownMenu.height();if(($window.height()+winScrollTop-offsetTop)<menuHeight&&offsetTop>(menuHeight+winScrollTop)){$parent.addClass("dropup")}else{$parent.removeClass("dropup")}},10)}var dmcss={};if(options.listAlign==="left"){dmcss={"left":$input.siblings("div").width()-parentWidth,"right":"auto"}}else{if(options.listAlign==="right"){dmcss={"left":"auto","right":0}}}if(isIe&&!options.showBtn){if(!$parent.hasClass("dropup")){dmcss.top=parentHeight;dmcss.bottom="auto"}else{dmcss.top="auto";dmcss.bottom=parentHeight}}if(!options.autoMinWidth){dmcss.minWidth=parentWidth}$dropdownMenu.css(dmcss);return $input}function setBackground($input,options){var inputbg,bg,warnbg;if((options.indexId===-1&&!options.idField)||options.multiWord){return $input}bg=options.inputBgColor;warnbg=options.inputWarnColor;var curVal=$input.val();var preVal=$input.data("pre-val");if(setOrGetDataId($input)||!curVal){$input.css("background",bg||"");if(!curVal&&preVal){$input.trigger("onUnsetSelectValue").data("pre-val","")}return $input}inputbg=$input.css("backgroundColor").replace(/ /g,"").split(",",3).join(",");if(!~warnbg.indexOf(inputbg)){$input.trigger("onUnsetSelectValue").data("pre-val","").css("background",warnbg)}return $input}function adjustScroll($input,$dropdownMenu,options){var $hover=$input.parent().find("tbody tr."+options.listHoverCSS),pos,maxHeight;if($hover.length){pos=($hover.index()+3)*$hover.height();maxHeight=+$dropdownMenu.css("maxHeight").replace("px","");if(pos>maxHeight||$dropdownMenu.scrollTop()>maxHeight){pos=pos-maxHeight}else{pos=0}$dropdownMenu.scrollTop(pos)}}function unHoverAll($dropdownMenu,options){$dropdownMenu.find("tr."+options.listHoverCSS).removeClass(options.listHoverCSS)}function checkInput($input,$dropdownMenu,options){if(!$dropdownMenu.length||$input.data(BSSUGGEST)){return FALSE}$input.data(BSSUGGEST,{options:options});return TRUE}function checkData(data){var isEmpty=TRUE,o;for(o in data){if(o==="value"){isEmpty=FALSE;break}}if(isEmpty){handleError("返回数据格式错误!");return FALSE}if(!data.value.length){return FALSE}return data}function inEffectiveFields(field,options){var effectiveFields=options.effectiveFields;return !(field==="__index"||effectiveFields.length&&!~$.inArray(field,effectiveFields))}function inSearchFields(field,options){return ~$.inArray(field,options.searchFields)}function showTip(tip,$input,$dropdownMenu,options){$dropdownMenu.html('<div style="padding:10px 5px 5px">'+tip+"</div>").show();adjustDropMenuPos($input,$dropdownMenu,options)}function showDropMenu($input,options){var $dropdownMenu=$input.parent().find("ul:eq(0)");if(!$dropdownMenu.is(":visible")){$dropdownMenu.show();$input.trigger("onShowDropdown",[options?options.data.value:[]])}}function hideDropMenu($input,options){var $dropdownMenu=$input.parent().find("ul:eq(0)");if($dropdownMenu.is(":visible")){$dropdownMenu.hide();$input.trigger("onHideDropdown",[options?options.data.value:[]])
}}function refreshDropMenu($input,data,options){var $dropdownMenu=$input.parent().find("ul:eq(0)"),len,i,field,index=0,tds,html=['<table class="table table-condensed table-sm" style="margin:0">'],idValue,keyValue;var dataList=data.value;if(!data||!(len=dataList.length)){if(options.emptyTip){showTip(options.emptyTip,$input,$dropdownMenu,options)}else{$dropdownMenu.empty();hideDropMenu($input,options)}return $input}if(options._lastData&&JSON.stringify(options._lastData)===JSON.stringify(data)&&$dropdownMenu.find("tr").length===len){showDropMenu($input,options);return adjustDropMenuPos($input,$dropdownMenu,options)}options._lastData=data;if(options.showHeader){html.push("<thead><tr>");for(field in dataList[0]){if(!inEffectiveFields(field,options)){continue}html.push("<th>",(options.effectiveFieldsAlias[field]||field),index===0?("("+len+")"):"","</th>");index++}html.push("</tr></thead>")}html.push("<tbody>");var dataI;for(i=0;i<len;i++){index=0;tds=[];dataI=dataList[i];idValue=dataI[options.idField];keyValue=dataI[options.keyField];for(field in dataI){if(isUndefined(keyValue)&&options.indexKey===index){keyValue=dataI[field]}if(isUndefined(idValue)&&options.indexId===index){idValue=dataI[field]}index++;if(inEffectiveFields(field,options)){tds.push('<td data-name="',field,'">',dataI[field],"</td>")}}html.push('<tr data-index="',(dataI.__index||i),'" data-id="',idValue,'" data-key="',keyValue,'">',tds.join(""),"</tr>")}html.push("</tbody></table>");$dropdownMenu.html(html.join(""));showDropMenu($input,options);setTimeout(function(){if(notNeedCalcPadding){return}var $table=$dropdownMenu.find("table:eq(0)"),pdr=0,mgb=0;if($dropdownMenu.height()<$table.height()&&+$dropdownMenu.css("minWidth").replace("px","")<$dropdownMenu.width()){pdr=18;mgb=20}$dropdownMenu.css("paddingRight",pdr);$table.css("marginBottom",mgb)},301);adjustDropMenuPos($input,$dropdownMenu,options);return $input}function ajax(options,keyword){keyword=keyword||"";var preAjax=options._preAjax;if(preAjax&&preAjax.abort&&preAjax.readyState!==4){preAjax.abort()}var ajaxParam={type:"GET",dataType:options.jsonp?"jsonp":"json",timeout:5000,};if(options.jsonp){ajaxParam.jsonp=options.jsonp}var adjustAjaxParam,fnAdjustAjaxParam=options.fnAdjustAjaxParam;if($.isFunction(fnAdjustAjaxParam)){adjustAjaxParam=fnAdjustAjaxParam(keyword,options);if(FALSE===adjustAjaxParam){return}$.extend(ajaxParam,adjustAjaxParam)}ajaxParam.url=function(){if(!keyword||ajaxParam.data){return ajaxParam.url||options.url}var type="?";if(/=$/.test(options.url)){type=""}else{if(/\?/.test(options.url)){type="&"}}return options.url+type+encodeURIComponent(keyword)}();return options._preAjax=$.ajax(ajaxParam).done(function(result){options.data=options.fnProcessData(result)}).fail(function(err){if(options.fnAjaxFail){options.fnAjaxFail(err,options)}})}function isInWord(keyword,key,value,options){value=$.trim(value);if(options.ignorecase){keyword=keyword.toLocaleLowerCase();value=value.toLocaleLowerCase()}return value&&(inEffectiveFields(key,options)||inSearchFields(key,options))&&(~value.indexOf(keyword)||options.twoWayMatch&&~keyword.indexOf(value))}function getData(keyword,$input,callback,options){var data,validData,filterData={value:[]},i,key,len,fnPreprocessKeyword=options.fnPreprocessKeyword;keyword=keyword||"";if($.isFunction(fnPreprocessKeyword)){keyword=fnPreprocessKeyword(keyword,options)}if(options.url){var timer;if(options.searchingTip){timer=setTimeout(function(){showTip(options.searchingTip,$input,$input.parent().find("ul"),options)},600)}ajax(options,keyword).done(function(result){callback($input,options.data,options);$input.trigger(onDataRequestSuccess,result);if(options.getDataMethod==="firstByUrl"){options.url=null}}).always(function(){timer&&clearTimeout(timer)})}else{data=options.data;validData=checkData(data);if(validData){if(keyword){len=data.value.length;for(i=0;i<len;i++){for(key in data.value[i]){if(data.value[i][key]&&isInWord(keyword,key,data.value[i][key]+"",options)){filterData.value.push(data.value[i]);filterData.value[filterData.value.length-1].__index=i;break}}}}else{filterData=data}}callback($input,filterData,options)}}function processData(data){return checkData(data)}function getIClear($input,options){var $iClear=$input.prev("i.clearable");if(options.clearable&&!$iClear.length){$iClear=$('<i class="clearable glyphicon glyphicon-remove fa fa-plus"></i>').prependTo($input.parent())}return $iClear.css({position:"absolute",top:"calc(50% - 6px)",transform:"rotate(45deg)",zIndex:4,cursor:"pointer",width:"14px",lineHeight:"14px",textAlign:"center",fontSize:12}).hide()}var defaultOptions={url:null,jsonp:null,data:{value:[]},indexId:0,indexKey:0,idField:"",keyField:"",autoSelect:TRUE,allowNoKeyword:TRUE,getDataMethod:"firstByUrl",delayUntilKeyup:FALSE,ignorecase:FALSE,effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],twoWayMatch:TRUE,multiWord:FALSE,separator:",",delay:300,emptyTip:"",searchingTip:"搜索中...",hideOnSelect:FALSE,autoDropup:FALSE,autoMinWidth:FALSE,showHeader:FALSE,showBtn:TRUE,inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px","overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s","word-break":"keep-all","white-space":"nowrap"},listAlign:"left",listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",clearable:FALSE,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnProcessData:processData,fnGetData:getData,fnAdjustAjaxParam:null,fnPreprocessKeyword:null,fnAjaxFail:null,};
var methods={init:function(options){var self=this;options=options||{};if(isUndefined(options.showHeader)&&options.effectiveFields&&options.effectiveFields.length>1){options.showHeader=TRUE}options=$.extend(TRUE,{},defaultOptions,options);if(options.processData){options.fnProcessData=options.processData}if(options.getData){options.fnGetData=options.getData}if(options.getDataMethod==="firstByUrl"&&options.url&&!options.delayUntilKeyup){ajax(options).done(function(result){options.url=null;self.trigger(onDataRequestSuccess,result)})}if(!$("#"+BSSUGGEST).length){$("head:eq(0)").append('<style id="'+BSSUGGEST+'">.'+options.listHoverCSS+"{"+options.listHoverStyle+"}</style>")}return self.each(function(){var $input=$(this),$parent=$input.parent(),$iClear=getIClear($input,options),isMouseenterMenu,keyupTimer,$dropdownMenu=$parent.find("ul:eq(0)");$dropdownMenu.parent().css("position","relative");if(!checkInput($input,$dropdownMenu,options)){console.warn("不是一个标准的 bootstrap 下拉式菜单或已初始化:",$input);return}if(!options.showBtn){$input.css("borderRadius",4);$parent.css("width","100%").find(".btn:eq(0)").hide()}$input.removeClass(DISABLED).prop(DISABLED,FALSE).attr("autocomplete","off");$dropdownMenu.css(options.listStyle);if(!options.inputBgColor){options.inputBgColor=$input.css("backgroundColor")}$input.on("keydown",function(event){var currentList,tipsKeyword;if(!$dropdownMenu.is(":visible")){setOrGetDataId($input,"");return}currentList=$dropdownMenu.find("."+options.listHoverCSS);tipsKeyword="";unHoverAll($dropdownMenu,options);if(event.keyCode===options.keyDown){if(!currentList.length){tipsKeyword=getPointKeyword($dropdownMenu.find("tbody tr:first").mouseover())}else{if(!currentList.next().length){if(options.autoSelect){setOrGetDataId($input,"").val(setOrGetAlt($input))}}else{tipsKeyword=getPointKeyword(currentList.next().mouseover())}}adjustScroll($input,$dropdownMenu,options);if(!options.autoSelect){return}}else{if(event.keyCode===options.keyUp){if(!currentList.length){tipsKeyword=getPointKeyword($dropdownMenu.find("tbody tr:last").mouseover())}else{if(!currentList.prev().length){if(options.autoSelect){setOrGetDataId($input,"").val(setOrGetAlt($input))}}else{tipsKeyword=getPointKeyword(currentList.prev().mouseover())}}adjustScroll($input,$dropdownMenu,options);if(!options.autoSelect){return}}else{if(event.keyCode===options.keyEnter){tipsKeyword=getPointKeyword(currentList);hideDropMenu($input,options)}else{setOrGetDataId($input,"")}}}setValue($input,tipsKeyword,options)}).on("compositionstart",function(event){inputLock=TRUE}).on("compositionend",function(event){inputLock=FALSE}).on("keyup input paste",function(event){var word;if(event.keyCode){setBackground($input,options)}if(~$.inArray(event.keyCode,[options.keyDown,options.keyUp,options.keyEnter])){$input.val($input.val());return}clearTimeout(keyupTimer);keyupTimer=setTimeout(function(){if(inputLock){return}word=$input.val();if($.trim(word)&&word===setOrGetAlt($input)){return}setOrGetAlt($input,word);if(options.multiWord){word=word.split(options.separator).reverse()[0]}if(!word.length&&!options.allowNoKeyword){return}options.fnGetData($.trim(word),$input,refreshDropMenu,options)},options.delay||300)}).on("focus",function(){adjustDropMenuPos($input,$dropdownMenu,options)}).on("blur",function(){if(!isMouseenterMenu){hideDropMenu($input,options)}}).on("click",function(){var word=$input.val();if($.trim(word)&&word===setOrGetAlt($input)&&$dropdownMenu.find("table tr").length){return showDropMenu($input,options)}if($dropdownMenu.is(":visible")){return}if(options.multiWord){word=word.split(options.separator).reverse()[0]}if(!word.length&&!options.allowNoKeyword){return}options.fnGetData($.trim(word),$input,refreshDropMenu,options)});$parent.find(".btn:eq(0)").attr("data-toggle","").click(function(){if(!$dropdownMenu.is(":visible")){if(options.url){$input.click().focus();if(!$dropdownMenu.find("tr").length){return FALSE}}else{refreshDropMenu($input,options.data,options)}showDropMenu($input,options)}else{hideDropMenu($input,options)}return FALSE});$dropdownMenu.mouseenter(function(){isMouseenterMenu=1;$input.blur()}).mouseleave(function(){isMouseenterMenu=0;$input.focus()}).on("mouseenter","tbody tr",function(){unHoverAll($dropdownMenu,options);$(this).addClass(options.listHoverCSS);return FALSE}).on("mousedown","tbody tr",function(){var keywords=getPointKeyword($(this));setValue($input,keywords,options);setOrGetAlt($input,keywords.key);setBackground($input,options);if(options.hideOnSelect){hideDropMenu($input,options)}});if($iClear.length){$iClear.click(function(){setOrGetDataId($input,"").val("");setBackground($input,options)});$parent.mouseenter(function(){if(!$input.prop(DISABLED)){$iClear.css("right",options.showBtn?Math.max($input.next().width(),33)+2:12).show()}}).mouseleave(function(){$iClear.hide()})}})},show:function(){return this.each(function(){$(this).click()})},hide:function(){return this.each(function(){hideDropMenu($(this))})},disable:function(){return this.each(function(){$(this).attr(DISABLED,TRUE).parent().find(".btn:eq(0)").prop(DISABLED,TRUE)
})},enable:function(){return this.each(function(){$(this).attr(DISABLED,FALSE).parent().find(".btn:eq(0)").prop(DISABLED,FALSE)})},destroy:function(){return this.each(function(){$(this).off().removeData(BSSUGGEST).removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop(DISABLED,FALSE).next().css("display","").off()})},version:function(){return VERSION}};$.fn[BSSUGGEST]=function(options){if(typeof options==="string"&&methods[options]){var inited=TRUE;this.each(function(){if(!$(this).data(BSSUGGEST)){return inited=FALSE}});if(!inited&&"init"!==options&&"version"!==options){return this}return methods[options].apply(this,[].slice.call(arguments,1))}else{return methods.init.apply(this,arguments)}}});